// ======================================
// â˜ï¸ Firebase Storage Rulesï¼ˆ2025.11 æœ€æ–°å®‰å®šç‰ˆï¼‰
// ShapeNote ç”¨
// ======================================

rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {

    // ===============================
    // ğŸ§© å…±é€šé–¢æ•°
    // ===============================
    function isSignedIn() {
      return request.auth != null;
    }

    // ===============================
    // ğŸ–¼ user_icons ãƒ•ã‚©ãƒ«ãƒ€
    // å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªåˆ†ã®ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    // ===============================
    match /user_icons/{uid}/{fileName=**} {
      // ğŸ”¹ èª­ã¿å–ã‚Šï¼šèª°ã§ã‚‚å¯ï¼ˆFirestore ã® URL ç®¡ç†å‰æï¼‰
      allow read: if true;

      // ğŸ”¹ æ›¸ãè¾¼ã¿ï¼šè‡ªåˆ†ã®ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ã¿è¨±å¯
      allow write: if isSignedIn() && request.auth.uid == uid;
    }

    // ===============================
    // ğŸ§‘â€ğŸ’¼ admin_uploads ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆç®¡ç†è€…ç´ æç½®ãå ´ï¼‰
    // ===============================
    match /admin_uploads/{fileName=**} {
      allow read: if true; // ç´ æã¨ã—ã¦é¡§å®¢ã‚‚é–²è¦§OK
      allow write: if request.auth.token.email == "sakauchi.pilates@gmail.com";
    }

    // ===============================
    // ğŸ‹ï¸ exercise_sheets ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è³‡æ–™ãªã©ï¼‰
    // ===============================
    match /exercise_sheets/{uid}/{fileName=**} {
      allow read: if isSignedIn()
                  && (request.auth.uid == uid || request.auth.token.email == "sakauchi.pilates@gmail.com");
      allow write: if isSignedIn() && request.auth.uid == uid;
    }

    // ===============================
    // ğŸš« ãã®ä»–ã™ã¹ã¦æ‹’å¦
    // ===============================
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}